<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pathway.title %> - Siber Güvenlik Akademi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="/">Siber Güvenlik Akademi</a>
            </div>
            <ul class="nav-links">
                <li><a href="/">Ana Sayfa</a></li>
                <li><a href="/pathways">Kariyer Yolları</a></li>
                <% if (user) { %>
                    <li><a href="/dashboard">Panelim</a></li>
                    <li><a href="/logout">Çıkış Yap</a></li>
                <% } else { %>
                    <li><a href="/login">Giriş Yap</a></li>
                    <li><a href="/register">Kayıt Ol</a></li>
                <% } %>
            </ul>
        </nav>
    </header>

    <div class="pathway-details">
        <div class="pathway-header">
            <h1><%= pathway.title %></h1>
            <p class="pathway-description"><%= pathway.description %></p>
            <div class="pathway-meta">
                <span><i class="fas fa-signal"></i> Seviye: <%= pathway.level %></span>
                <span><i class="fas fa-calendar-alt"></i> Tahmini Süre: <%= pathway.duration_weeks %> Hafta</span>
                <% if (userProgress) { %>
                    <span><i class="fas fa-chart-line"></i> İlerlemeniz: %<%= Number(userProgress.progress_percentage).toFixed(1) %></span>
                <% } %>
            </div>
        </div>

        <div class="modules-container">
            <div class="career-info">
                <h2>Kariyer Bilgileri</h2>
                <p>SOC Analistleri, bir organizasyonun güvenlik operasyon merkezinde çalışarak siber tehditleri tespit eder, analiz eder ve yanıt verir. Bu rol, sürekli öğrenme ve gelişim gerektiren dinamik bir pozisyondur.</p>
                
                <div class="career-features">
                    <div class="career-feature">
                        <i class="fas fa-chart-line"></i>
                        <h3>Kariyer Gelişimi</h3>
                        <p>Junior SOC Analistinden Senior SOC Analistine ve SOC Takım Liderine kadar yükselme imkanı</p>
                    </div>
                    <div class="career-feature">
                        <i class="fas fa-money-bill-wave"></i>
                        <h3>Maaş Aralığı</h3>
                        <p>15.000₺ - 45.000₺ (Deneyime bağlı olarak)</p>
                    </div>
                    <div class="career-feature">
                        <i class="fas fa-briefcase"></i>
                        <h3>İş Fırsatları</h3>
                        <p>Türkiye'de ve dünyada yüksek talep gören bir pozisyon</p>
                    </div>
                </div>
            </div>

            <% if (pathway.modules && pathway.modules.length > 0) { %>
                <% pathway.modules.forEach(module => { %>
                    <div class="module-card">
                        <div class="module-header">
                            <div class="module-header-left">
                                <h3>
                                    <% if (module.title.toLowerCase().includes('splunk')) { %>
                                        <i class="fas fa-database tool-icon"></i>
                                    <% } else if (module.title.toLowerCase().includes('siem')) { %>
                                        <i class="fas fa-shield-alt tool-icon"></i>
                                    <% } else { %>
                                        <i class="fas fa-tools tool-icon"></i>
                                    <% } %>
                                    <%= module.title %>
                                </h3>
                                <p><%= module.description %></p>
                                <div class="module-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-book"></i>
                                        <%= module.lessons.length %> Ders
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-clock"></i>
                                        Toplam <%= module.lessons.reduce((acc, lesson) => acc + lesson.duration_minutes, 0) %> dakika
                                    </span>
                                </div>
                            </div>
                            <% if (userProgress) { %>
                                <div class="module-progress">
                                    <div class="progress-circle" style="--progress: <%= (module.completed_lessons / module.lessons.length) * 100 %>%">
                                        <span><%= Math.round((module.completed_lessons / module.lessons.length) * 100) %>%</span>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                        
                        <div class="lessons-list">
                            <% module.lessons.forEach((lesson, index) => { %>
                                <div class="lesson-item">
                                    <div class="lesson-number"><%= index + 1 %></div>
                                    <div class="lesson-info">
                                        <h4><%= lesson.title %></h4>
                                        <p><%= lesson.description %></p>
                                        <div class="lesson-meta">
                                            <span class="duration">
                                                <i class="far fa-clock"></i>
                                                <%= lesson.duration_minutes %> dakika
                                            </span>
                                            <% if (userProgress) { %>
                                                <span class="lesson-status <%= lesson.status %>">
                                                    <% if (lesson.status === 'completed') { %>
                                                        <i class="fas fa-check-circle"></i> Tamamlandı
                                                    <% } else if (lesson.status === 'in_progress') { %>
                                                        <i class="fas fa-play-circle"></i> Devam Ediyor
                                                    <% } else { %>
                                                        <i class="far fa-circle"></i> Başlanmadı
                                                    <% } %>
                                                </span>
                                            <% } %>
                                        </div>
                                    </div>
                                    <div class="lesson-actions">
                                        <% if (userProgress) { %>
                                            <a href="/lesson/<%= lesson.id %>" class="btn-start">
                                                <% if (lesson.status === 'completed') { %>
                                                    <i class="fas fa-redo"></i> Tekrar İzle
                                                <% } else if (lesson.status === 'in_progress') { %>
                                                    <i class="fas fa-play"></i> Devam Et
                                                <% } else { %>
                                                    <i class="fas fa-play"></i> Başla
                                                <% } %>
                                            </a>
                                        <% } %>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    </div>
                <% }); %>
            <% } %>

            <div class="pathway-sidebar">
                <% if (!userProgress) { %>
                    <div class="career-stats">
                        <div class="stat-item">
                            <h4>Toplam Modül</h4>
                            <div class="stat-value"><%= pathway.modules.length %></div>
                        </div>
                        <div class="stat-item">
                            <h4>Toplam Ders</h4>
                            <div class="stat-value"><%= pathway.modules.reduce((acc, module) => acc + module.lessons.length, 0) %></div>
                        </div>
                        <div class="stat-item">
                            <h4>Toplam Süre</h4>
                            <div class="stat-value"><%= Math.round(pathway.modules.reduce((acc, module) => acc + module.lessons.reduce((acc2, lesson) => acc2 + lesson.duration_minutes, 0), 0) / 60) %> saat</div>
                        </div>
                    </div>
                    <button class="btn-enroll" onclick="enrollPathway(<%= pathway.id %>)">
                        <i class="fas fa-graduation-cap"></i> Kariyerime Başla
                    </button>
                    <div class="career-requirements">
                        <h3>Önerilen Ön Koşullar</h3>
                        <ul class="requirements-list">
                            <li>Temel ağ bilgisi</li>
                            <li>Linux temel komutları</li>
                            <li>Siber güvenlik temelleri</li>
                            <li>İngilizce okuma-anlama</li>
                        </ul>
                    </div>
                <% } else { %>
                    <div class="progress-box">
                        <h3>Genel İlerlemeniz</h3>
                        <div class="progress-bar">
                            <div class="progress" style="width: <%= userProgress.progress_percentage %>%"></div>
                        </div>
                        <p class="progress-text">%<%= Number(userProgress.progress_percentage).toFixed(1) %> tamamlandı</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <script>
        async function enrollPathway(pathwayId) {
            try {
                const response = await fetch(`/pathway/${pathwayId}/enroll`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Kariyer yoluna başarıyla kayıt oldunuz!');
                    if (data.redirectUrl) {
                        window.location.href = data.redirectUrl;
                    } else {
                        window.location.reload();
                    }
                } else {
                    alert(data.message || 'Kayıt olurken bir hata oluştu.');
                }
            } catch (error) {
                console.error('Kayıt hatası:', error);
                alert('Kayıt olurken bir hata oluştu.');
            }
        }
    </script>
</body>
</html> 